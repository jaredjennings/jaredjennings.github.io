<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>router bellyache</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Writing to think 2: Write harder </a></h1>
                <nav><ul>
                    <li class="active"><a href="/category/commentary.html">Commentary</a></li>
                    <li><a href="/category/compliance-at-home.html">Compliance at home</a></li>
                    <li><a href="/category/misc.html">misc</a></li>
                    <li><a href="/category/projects.html">Projects</a></li>
                    <li><a href="/category/security.html">Security</a></li>
                    <li><a href="/category/uncategorized.html">Uncategorized</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/router-bellyache.html" rel="bookmark"
           title="Permalink to router bellyache">router bellyache</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-04-21T23:22:00-04:00">
                Published: Fri 21 April 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/jaredj.html">jaredj</a>
        </address>
<p>In <a href="/category/commentary.html">Commentary</a>.</p>
<p>tags: <a href="/tag/somebodyoughta.html">somebodyoughta</a> </p>
</footer><!-- /.post-info -->      <p>I have a router that runs LEDE. It has 115 firewall rules. I made
these by typing stanzas of about eight lines each into a file
<cite>/etc/config/firewall</cite>. Not great, not bad. I've already <a class="reference external" href="/netconf-and-the-curse-of-consensus.html">held forth</a> on this some. But now the
path of least resistance for deploying web apps on my own
infrastructure seems to be to create jails on a FreeBSD system
(statically setting their IPv6 addresses), (security hardening
handwaving), and add a firewall rule to allow access to a jail from
some zone (e.g. my LAN, the Internet). This is now an orchestratey
kind of task. And in between my earlier rant and now, I've used
Ansible some.</p>
<p>There's an Ansible role to set the firewall configuration on an
OpenWRT routerâ€”but it only sets the entire configuration. To do this
orchestratey task, I would need to use <tt class="docutils literal">uci</tt> to make the edit. But
<tt class="docutils literal">uci</tt>, when you are setting something like a firewall rule, lets you
list all the things, add or remove a thing, and reorder things, but it
doesn't help you order them, for example by saying &quot;this one should go
after the one that has such-and-such set to so-and-so.&quot; Perhaps
NETCONF will save everything? I've been reading that Ansible is
ramping up support for it. But it's awful!</p>
<p>In the meantime, I've been using BSD more, and I sort of want it on my
router, if it's so much better designed or has a much nicer packet
filter or something. But BSD on routers seems to be sort of an x86
thing, like you get a desktop computer, put multiple network cards in
it, and voila; or you get a PCEngines board. It seems NetBSD won't run
on my MIPS-based router (specifically) while FreeBSD will (!?), and
FreeBSD for my router has nothing like the customization OpenWRT/LEDE
has, where entire subsystems of a usual desktop/server OS have been
removed and replaced with smaller, more purpose-built ones (glibc,
systemd, dbus, NetworkManager, firewalld, ISC dhcpd, etc.). It looks
like NetBSD has a flash-specific filesystem (CHFS) for a while now,
and a way to statically link a whole bunch of binaries into a single
file and make the different subsumed commands runnable using
hardlinks. I have no idea of the relative merits of NPF vs. any of
FreeBSD's <cite>three</cite> packet filtering systems vs. iptables.</p>
<p>Somebodyoughta make a router OS out of a BSD, and stick 9P support in
it, and use Rust or Go or something for all the new hotness that gets
added.</p>

    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>